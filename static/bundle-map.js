import{r as d,R as e,a as L}from"./assets/client-DlR8uHNE.js";const H=a=>new Promise(c=>setTimeout(c,a)),Y=a=>(a==null?void 0:a.split(" ")[1])||"",z=()=>({getDataByRegion:async(c,h)=>{try{const r=await fetch("/api/v1/app/location/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({latitude:c,longitude:h})});if(!r.ok)throw new Error(`API request failed with status ${r.status}`);return await r.json()}catch(r){return console.error("Error during data retrieval:",r),{error:r.message}}},spliter:Y}),G=({validator:a,onTimeDataUpdate:c})=>{const{getDataByRegion:h,spliter:r}=z();return d.useEffect(()=>{if(!a||a.length===0){console.warn("Validator is empty"),c([]);return}(async()=>{const s=[];for(let f=0;f<a.length;f++)try{if(a[f]===0){s.push({id:f,time:"00:00:00",error:"Geocoding failed"});continue}f>0&&await H(2e3);const n=await h(a[f][0],a[f][1]);let t="00:00:00",g=null;n!=null&&n.formatted?t=r(n.formatted):n!=null&&n.time?t=n.time:g=(n==null?void 0:n.error)||"Invalid response structure",s.push({id:f,time:t,error:g})}catch(n){console.error(`Error processing point ${f}:`,n),s.push({id:f,time:"00:00:00",error:"API request failed"})}c(s)})()},[a]),null};function q({locations:a=[],connectionTypes:c=[],onTimeDataUpdate:h,creatingNewPoint:r,setCreatingNewPoint:y}){const[s,v]=d.useState([]),f=d.useRef(null),n=d.useRef(null),t=d.useRef([]),[g,b]=d.useState(null);d.useEffect(()=>{if(!(!window.ymaps||n.current))return window.ymaps.ready(()=>{try{const o=new window.ymaps.Map(f.current,{center:[55.76,37.64],zoom:3,controls:["zoomControl","searchControl"]});n.current=o,t.current=[],S(o)}catch(o){console.error("Error initializing map:",o)}}),()=>{n.current&&(t.current.forEach(o=>{n.current.geoObjects.remove(o)}),n.current.destroy(),n.current=null,t.current=[])}},[]),d.useEffect(()=>{if(!n.current)return;const o=l=>{r&&(b(l.get("coords")),y(!1))};return n.current.events.add("click",o),()=>{n.current.events.remove("click",o)}},[r]),d.useEffect(()=>{if(!g)return;(async()=>{try{console.log("Clicked on map:",g);const i=(await ymaps.geocode(g)).geoObjects.get(0).getAddressLine();a.push(i),console.log("Deleting old bullshit..."),t.current.forEach(p=>{n.current.geoObjects.remove(p)}),t.current=[],console.log("goint to start process locations"),S(n.current),console.log("ENDED ADDING POINT")}catch(l){console.error("Error processing click:",l)}finally{b(null)}})()},[g]),d.useEffect(()=>{n.current&&(t.current.forEach(o=>{n.current.geoObjects.remove(o)}),t.current=[],S(n.current))},[a,c]);const S=async o=>{if(!a.length)return;console.log("Processing locations: ",a);const l=[],E=[];for(let i=0;i<a.length;i++)try{const p=await D(a[i]);E.push(p),l.push(p);const w=new window.ymaps.Placemark(p,{balloonContent:a[i]});o.geoObjects.add(w),t.current.push(w)}catch(p){console.error(`Error geocoding location ${a[i]}:`,p),l.push(0)}if(E.length>1){console.log(c);for(let i=0;i<E.length-1;i++){const p=E[i],w=E[i+1],C=c[i]||"poliline";p&&w&&m(o,p,w,C)}}v(l)},D=o=>new Promise((l,E)=>{window.ymaps.geocode(o,{results:1}).then(i=>{const p=i.geoObjects.get(0);p?l(p.geometry.getCoordinates()):E(`No results for address: ${o}`)},i=>{E(`Geocoding error for address: ${o}, ${i}`)})}),m=(o,l,E,i)=>{if(i==="car"){const p=new window.ymaps.multiRouter.MultiRoute({referencePoints:[l,E],params:{routingMode:"auto"}},{boundsAutoApply:!0});o.geoObjects.add(p),t.current.push(p),p.model.events.add("requestsuccess",function(){try{const C=p.getActiveRoute().properties.get("distance").value;console.log(`Route distance: ${C} meters`)}catch{console.warn("Failed to get route info, drawing polyline instead"),u(o,l,E)}})}else u(o,l,E)},u=(o,l,E)=>{const i=new window.ymaps.Polyline([l,E],{hintContent:"Route"},{strokeColor:"#0000FF",strokeWidth:4,strokeOpacity:.7});o.geoObjects.add(i),t.current.push(i)};return e.createElement(e.Fragment,null,e.createElement("div",{ref:f,style:{width:"100%",height:"400px"}}),e.createElement(G,{validator:s,onTimeDataUpdate:h}))}function Z(a){const[c,h]=d.useState(a);return d.useEffect(()=>{if(h(a),!a||a==="00:00:00")return;const r=setInterval(()=>{h(y=>{const[s,v,f]=y.split(":").map(Number);let n=f+1,t=v,g=s;return n>=60&&(n=0,t+=1),t>=60&&(t=0,g+=1),g>=24&&(g=0),`${String(g).padStart(2,"0")}:${String(t).padStart(2,"0")}:${String(n).padStart(2,"0")}`})},1e3);return()=>clearInterval(r)},[a]),c}const K=[{code:"AUD",name:"Australian Dollar"},{code:"BGN",name:"Bulgarian Lev"},{code:"BRL",name:"Brazilian Real"},{code:"CAD",name:"Canadian Dollar"},{code:"CHF",name:"Swiss Franc"},{code:"CNY",name:"Chinese Yuan"},{code:"CZK",name:"Czech Koruna"},{code:"DKK",name:"Danish Krone"},{code:"EUR",name:"Euro"},{code:"GBP",name:"British Pound Sterling"},{code:"HKD",name:"Hong Kong Dollar"},{code:"HUF",name:"Hungarian Forint"},{code:"IDR",name:"Indonesian Rupiah"},{code:"ILS",name:"Israeli New Shekel"},{code:"INR",name:"Indian Rupee"},{code:"ISK",name:"Icelandic Krona"},{code:"JPY",name:"Japanese Yen"},{code:"KRW",name:"South Korean Won"},{code:"MXN",name:"Mexican Peso"},{code:"MYR",name:"Malaysian Ringgit"},{code:"NOK",name:"Norwegian Krone"},{code:"NZD",name:"New Zealand Dollar"},{code:"PHP",name:"Philippine Peso"},{code:"PLN",name:"Polish Zloty"},{code:"RON",name:"Romanian Leu"},{code:"SEK",name:"Swedish Krona"},{code:"SGD",name:"Singapore Dollar"},{code:"THB",name:"Thai Baht"},{code:"TRY",name:"Turkish Lira"},{code:"USD",name:"United States Dollar"},{code:"ZAR",name:"South African Rand"}];function J({totalScore:a}){const[c,h]=d.useState(!1),[r,y]=d.useState("USD"),[s,v]=d.useState(a),f=async n=>{const t=n.target.value;if(t!==r){h(!0);try{if(t==="USD")v(a);else{const S=(await(await fetch(`https://api.frankfurter.dev/v1/latest?base=USD&symbols=${t}`)).json()).rates[t];v((parseFloat(a)*S).toFixed(2))}y(t)}catch(g){console.error("Conversion error:",g)}finally{h(!1)}}};return d.useEffect(()=>{r==="USD"?v(a):fetch(`https://api.frankfurter.dev/v1/latest?base=USD&symbols=${r}`).then(n=>n.json()).then(n=>{const t=n.rates[r];v((parseFloat(a)*t).toFixed(2))}).catch(console.error)},[a]),e.createElement("div",{className:"summ-price"},e.createElement("div",null,e.createElement("span",{className:"label"},"ðŸ’µ ÐŸÐ¾Ð»Ð½Ð°Ñ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ:"),e.createElement("p2",{id:"rater"},r),e.createElement("span",{id:"summary",className:"value"},c?"Converting...":s)),e.createElement("select",{id:"selector",className:"select-container",onChange:f,value:r,disabled:c},K.map(n=>e.createElement("option",{key:n.code,value:n.code},n.name))))}function V({location:a,i:c,timeData:h,data:r,onPointUpdate:y}){var i,p,w,C,A,P,k,I,O,U,$,T,M;const s=h.find(N=>N.id===c)||{},v=Z(s.time),[f,n]=d.useState(!((i=r.date_out)!=null&&i[c])),[t,g]=d.useState({loc:a,typic:((p=r.typic)==null?void 0:p[c])||"poliline",date_to:((w=r.date_to)==null?void 0:w[c])||"",date_out:((C=r.date_out)==null?void 0:C[c])||"",air:((A=r.air)==null?void 0:A[c])||"",air2:((P=r.air2)==null?void 0:P[c])||"",icao:((k=r.icao)==null?void 0:k[c])||"",icao2:((I=r.icao2)==null?void 0:I[c])||"",gost:((O=r.gost)==null?void 0:O[c])||"",cost:(U=r.cost)!=null&&U[c]?r.cost[c].split("-")[0]:"",rec:(($=r.rec)==null?void 0:$[c])||"",currency:(T=r.cost)!=null&&T[c]&&r.cost[c].split("-")[1]||"USD"}),b=t.air&&t.air!=="!"&&t.air!==void 0,S=t.air2&&t.air2!=="!"&&t.air2!==void 0,D=t.icao&&t.icao!=="!"&&t.icao!==void 0,m=t.icao2&&t.icao2!=="!"&&t.icao2!==void 0,u=t.date_to&&t.date_to!=="!"&&t.date_to!==void 0,o=N=>{const{name:_,value:R}=N.target;g(F=>({...F,[_]:R}))},l=()=>{n(!1);const N={loc:t.loc,typic:t.typic,date_to:t.date_to,date_out:t.date_out,air:t.air,air2:t.air2,icao:t.icao,icao2:t.icao2,gost:t.gost,cost:`${t.cost}-${t.currency}`,rec:t.rec};y(c,N)},E=(N,_)=>{if(!N||!_)return null;const R=new Date(N),B=new Date(_)-R,j=Math.ceil(B/(1e3*60*60*24));return j>0?j:null};return f?e.createElement("div",{className:"route-point",key:`point-${c}`},e.createElement("div",{className:"point-header"},e.createElement("h3",null,"ðŸ“ ",a||"ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ð¾",e.createElement("p",{className:`rater-${c} time-displayer`,style:{color:s.error?"red":"inherit"}},"â° ",s.error?"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸":v))),e.createElement("div",null,e.createElement("span",{className:"label"},"Ð¡Ð¿Ð¾ÑÐ¾Ð± Ð¿ÐµÑ€ÐµÐ´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ñ:"),e.createElement("select",{name:"typic",value:t.typic,onChange:o},e.createElement("option",{value:"poliline",selected:!0},"poliline"),e.createElement("option",{value:"car"},"car"))),e.createElement("div",{className:"point-dates"},e.createElement("div",null,e.createElement("span",{className:"label"},"ÐŸÑ€Ð¸Ð±Ñ‹Ñ‚Ð¸Ðµ:"),e.createElement("input",{type:"date",name:"date_to",value:t.date_to,onChange:o,required:!0})),e.createElement("div",null,e.createElement("span",{className:"label"},"ÐžÑ‚Ð±Ñ‹Ñ‚Ð¸Ðµ:"),e.createElement("input",{type:"date",name:"date_out",value:t.date_out,onChange:o,required:!0}))),e.createElement("div",null,e.createElement("span",{className:"label"},"ÐÑÑ€Ð¾Ð¿Ð¾Ñ€Ñ‚ Ð¿Ñ€Ð¸Ð»ÐµÑ‚Ð°:"),e.createElement("input",{type:"text",name:"air",value:t.air,onChange:o})),e.createElement("div",null,e.createElement("span",{className:"label"},"ÐÑÑ€Ð¾Ð¿Ð¾Ñ€Ñ‚ Ð²Ñ‹Ð»ÐµÑ‚Ð°:"),e.createElement("input",{type:"text",name:"air2",value:t.air2,onChange:o})),e.createElement("div",null,e.createElement("span",{className:"label"},"ICAO ÐºÐ¾Ð´ Ð¿Ñ€Ð¸Ð»ÐµÑ‚Ð°:"),e.createElement("input",{type:"text",name:"icao",value:t.icao,onChange:o})),e.createElement("div",null,e.createElement("span",{className:"label"},"ICAO ÐºÐ¾Ð´ Ð²Ñ‹Ð»ÐµÑ‚Ð°:"),e.createElement("input",{type:"text",name:"icao2",value:t.icao2,onChange:o})),e.createElement("div",{className:"hotel-label"},e.createElement("span",{className:"label"},"Ð“Ð¾ÑÑ‚Ð¸Ð½Ð¸Ñ†Ð°:"),e.createElement("input",{type:"text",name:"gost",value:t.gost,onChange:o})),e.createElement("div",{className:"point-price"},e.createElement("span",{className:"label"},"Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ:"),e.createElement("input",{type:"text",name:"cost",value:t.cost,onChange:o}),e.createElement("select",{name:"currency",value:t.currency,onChange:o},K.map(N=>e.createElement("option",{key:N.code,value:N.code},N.code)))),e.createElement("button",{onClick:l,disabled:!t.date_to||!t.date_out,className:"save-btn"},"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ")):e.createElement("div",{className:"route-point",key:`point-${c}`},e.createElement("div",{className:"point-header"},e.createElement("h3",null,"ðŸ“ ",a||"ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ð¾",e.createElement("p",{className:`rater-${c} time-displayer`,style:{color:s.error?"red":"inherit"}},"â° ",s.error?"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸":v)),u&&e.createElement("span",{className:"badge"},"Ð Ð°ÑÑ‡Ñ‘Ñ‚ Ð´Ð½ÐµÐ¹: ",E(t.date_to,t.date_out)||"N/A")),e.createElement("div",null,"Ð¡Ð¿Ð¾ÑÐ¾Ð± Ð¿ÐµÑ€ÐµÐ´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ñ - ",t.typic||"ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ð¾"),e.createElement("div",{className:"point-dates"},u&&e.createElement("div",null,e.createElement("span",{className:"label"},"ÐŸÑ€Ð¸Ð±Ñ‹Ñ‚Ð¸Ðµ:"),e.createElement("span",{className:"value"},t.date_to)),e.createElement("div",null,e.createElement("span",{className:"label"},"ÐžÑ‚Ð±Ñ‹Ñ‚Ð¸Ðµ:"),e.createElement("span",{className:"value"},t.date_out||"ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ð¾"))),b&&e.createElement("div",null,e.createElement("span",{className:"label"},"ÐÑÑ€Ð¾Ð¿Ð¾Ñ€Ñ‚ Ð¿Ñ€Ð¸Ð»ÐµÑ‚Ð°:"),e.createElement("span",{className:"value"},t.air)),S&&e.createElement("div",null,e.createElement("span",{className:"label"},"ÐÑÑ€Ð¾Ð¿Ð¾Ñ€Ñ‚ Ð²Ñ‹Ð»ÐµÑ‚Ð°:"),e.createElement("span",{className:"value"},t.air2)),D&&e.createElement("div",null,e.createElement("span",{className:"label"},"ICAO ÐºÐ¾Ð´ Ð¿Ñ€Ð¸Ð»ÐµÑ‚Ð°:"),e.createElement("span",{className:"value"},t.icao)),m&&e.createElement("div",null,e.createElement("span",{className:"label"},"ICAO ÐºÐ¾Ð´ Ð²Ñ‹Ð»ÐµÑ‚Ð°:"),e.createElement("span",{className:"value"},t.icao2)),e.createElement("div",{className:"hotel-label"},e.createElement("span",{className:"label"},"Ð“Ð¾ÑÑ‚Ð¸Ð½Ð¸Ñ†Ð°:"),e.createElement("span",{className:"value"},t.gost||"ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ð¾")),e.createElement("div",{className:"point-price"},e.createElement("span",{className:"label"},"Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ:"),e.createElement("span",{className:"value"},t.cost&&t.currency?`${t.cost}-${t.currency}`:"0-USD")),((M=r.rec)==null?void 0:M[c])&&e.createElement("a",{href:r.rec[c],className:"booking-btn"},"Ð—Ð°Ð±Ñ€Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð³Ð¾ÑÑ‚Ð¸Ð½Ð¸Ñ†Ñƒ â†’"))}function W({data:a,timeData:c=[],onPointUpdate:h}){return e.createElement("div",{className:"sidebar"},a.loc.map((r,y)=>e.createElement(V,{key:`point-${y}`,location:r,i:y,timeData:c,data:a,onPointUpdate:h})))}function Q({onSave:a}){return e.createElement("button",{className:"fixed-button",onClick:a},"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð¿ÑƒÑ‚ÐµÑˆÐµÑÑ‚Ð²Ð¸Ðµ")}function X({data:a}){const[c,h]=d.useState([]),[r,y]=d.useState(!1),[s,v]=d.useState(a),[f,n]=d.useState(0);d.useEffect(()=>{const m=parseFloat(a.total_score)||0;n(m),g(a).then(u=>{n(o=>Math.max(o,u))})},[]);const t={loc:a.loc||[],date_to:a.date_to||[],date_out:a.date_out||[],gost:a.gost||[],wait:a.wait||[],cost:a.cost||[],rec:a.rec||[],air:a.air||[],air2:a.air2||[],icao:a.icao||[],icao2:a.icao2||[],typic:a.typic||[],total_score:f.toString()},g=async m=>{let u=0;if(m.cost){for(let o=0;o<m.cost.length;o++)if(m.cost[o]){const[l,E]=m.cost[o].split("-"),i=parseFloat(l)||0;if(E.toUpperCase()==="USD")u+=i;else{const p=await S(E.toUpperCase(),"USD",i);u+=parseFloat(p)||0}}}return u},b=async(m,u)=>{const o={...s,loc:[...s.loc],typic:[...s.typic],date_to:[...s.date_to],date_out:[...s.date_out],air:[...s.air],air2:[...s.air2],icao:[...s.icao],icao2:[...s.icao2],gost:[...s.gost],cost:[...s.cost]};o.loc[m]=u.loc,o.typic[m]=u.typic,o.date_to[m]=u.date_to,o.date_out[m]=u.date_out,o.air[m]=u.air,o.air2[m]=u.air2,o.icao[m]=u.icao,o.icao2[m]=u.icao2,o.gost[m]=u.gost,o.cost[m]=u.cost;const l=await g(o);n(l),v(o)};if(!a||!Array.isArray(t.loc))return e.createElement("div",{className:"error-message"},"Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð½Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ñ‹ Ð¸Ð»Ð¸ Ð¸Ð¼ÐµÑŽÑ‚ Ð½ÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚");async function S(m,u,o){try{const E=await(await fetch(`https://api.frankfurter.dev/v1/latest?base=${m}&symbols=${u}`)).json();return(o*E.rates[u]).toFixed(2)}catch(l){return console.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ ÐºÐ¾Ð½Ð²ÐµÑ€Ñ‚Ð°Ñ†Ð¸Ð¸:",l),null}}const D=async()=>{try{const m=s.loc.map((o,l)=>({place:s.loc[l]||"!",to:s.date_to[l]||"!",out:s.date_out[l]||"!",airto:s.air[l]||"!",airout:s.air2[l]||"!",icao:s.icao[l]||"!",icao1:s.icao2[l]||null,hotel:s.gost[l]||"!",price:s.cost[l]||"0-USD",type:s.typic[l]||"poliline"}));(await fetch("http://127.0.0.1:8000/api/v1/app/send/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)})).ok?window.location.href="/api/v1/":console.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ð¸")}catch(m){console.error("ÐžÑˆÐ¸Ð±ÐºÐ°:",m)}};return e.createElement("div",{className:"map-page"},e.createElement(q,{locations:s.loc,connectionTypes:s.typic,onTimeDataUpdate:h,creatingNewPoint:r,setCreatingNewPoint:y}),e.createElement("div",{className:"sidebar-grid"},e.createElement(J,{totalScore:t.total_score}),e.createElement("div",{className:"overlay-container"},e.createElement(W,{data:t,timeData:c,onPointUpdate:b}),e.createElement("button",{className:"booking-btn",onClick:()=>y(!0),disabled:r,style:{cursor:r?"not-allowed":"pointer"}},"Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ñ‚Ð¾Ñ‡ÐºÑƒ â†’"))),e.createElement(Q,{onSave:D}))}const x=window.__MAP_DATA__||{loc:[],date_to:[],date_out:[],gost:[],wait:[],cost:[],rec:[],total_score:"0"},ee=L.createRoot(document.getElementById("map-root"));ee.render(e.createElement(X,{data:x}));
