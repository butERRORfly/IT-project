import{r as E,R as e,a as x}from"./assets/client-DlR8uHNE.js";const ee=t=>new Promise(a=>setTimeout(a,t)),te=t=>(t==null?void 0:t.split(" ")[1])||"",ne=()=>({getDataByRegion:async(a,y)=>{try{const r=await fetch("/api/v1/app/location/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({latitude:a,longitude:y})});if(!r.ok)throw new Error(`API request failed with status ${r.status}`);return await r.json()}catch(r){return console.error("Error during data retrieval:",r),{error:r.message}}},spliter:te}),oe=({validator:t,onTimeDataUpdate:a})=>{const{getDataByRegion:y,spliter:r}=ne();return E.useEffect(()=>{if(!t||t.length===0){console.warn("Validator is empty"),a([]);return}(async()=>{const g=[];for(let d=0;d<t.length;d++)try{if(t[d]===0){g.push({id:d,time:"00:00:00",error:"Geocoding failed"});continue}d>0&&await ee(2e3);const s=await y(t[d][0],t[d][1]);let o="00:00:00",f=null;s!=null&&s.formatted?o=r(s.formatted):s!=null&&s.time?o=s.time:f=(s==null?void 0:s.error)||"Invalid response structure",g.push({id:d,time:o,error:f})}catch(s){console.error(`Error processing point ${d}:`,s),g.push({id:d,time:"00:00:00",error:"API request failed"})}a(g)})()},[t]),null};function ae({locations:t=[],connectionTypes:a=[],onTimeDataUpdate:y,creatingNewPoint:r,setCreatingNewPoint:N}){const[g,v]=E.useState([]),d=E.useRef(null),s=E.useRef(null),o=E.useRef([]),[f,n]=E.useState(null);E.useEffect(()=>{if(!(!window.ymaps||s.current))return window.ymaps.ready(()=>{try{const m=new window.ymaps.Map(d.current,{center:[55.76,37.64],zoom:3,controls:["zoomControl","searchControl"]});s.current=m,o.current=[],w(m)}catch(m){console.error("Error initializing map:",m)}}),()=>{s.current&&(o.current.forEach(m=>{s.current.geoObjects.remove(m)}),s.current.destroy(),s.current=null,o.current=[])}},[]),E.useEffect(()=>{if(!s.current)return;const m=h=>{r&&(n(h.get("coords")),N(!1))};return s.current.events.add("click",m),()=>{s.current.events.remove("click",m)}},[r]),E.useEffect(()=>{if(!f)return;(async()=>{try{console.log("Clicked on map:",f);const c=(await ymaps.geocode(f)).geoObjects.get(0).getAddressLine();t.push(c),console.log("Deleting old bullshit..."),o.current.forEach(l=>{s.current.geoObjects.remove(l)}),o.current=[],console.log("goint to start process locations"),w(s.current),console.log("ENDED ADDING POINT")}catch(h){console.error("Error processing click:",h)}finally{n(null)}})()},[f]),E.useEffect(()=>{s.current&&(o.current.forEach(m=>{s.current.geoObjects.remove(m)}),o.current=[],w(s.current))},[t,a]);const w=async m=>{if(!t.length)return;console.log("Processing locations: ",t);const h=[],p=[];for(let c=0;c<t.length;c++)try{const l=await b(t[c]);p.push(l),h.push(l);const i=new window.ymaps.Placemark(l,{balloonContent:t[c]});m.geoObjects.add(i),o.current.push(i)}catch(l){console.error(`Error geocoding location ${t[c]}:`,l),h.push(0)}if(p.length>1){console.log(a);for(let c=0;c<p.length-1;c++){const l=p[c],i=p[c+1],u=a[c]||"poliline";l&&i&&_(m,l,i,u)}}v(h)},b=m=>new Promise((h,p)=>{window.ymaps.geocode(m,{results:1}).then(c=>{const l=c.geoObjects.get(0);l?h(l.geometry.getCoordinates()):p(`No results for address: ${m}`)},c=>{p(`Geocoding error for address: ${m}, ${c}`)})}),_=(m,h,p,c)=>{if(c==="car"){const l=new window.ymaps.multiRouter.MultiRoute({referencePoints:[h,p],params:{routingMode:"auto"}},{boundsAutoApply:!0});m.geoObjects.add(l),o.current.push(l),l.model.events.add("requestsuccess",function(){try{const u=l.getActiveRoute().properties.get("distance").value;console.log(`Route distance: ${u} meters`)}catch{console.warn("Failed to get route info, drawing polyline instead"),D(m,h,p)}})}else D(m,h,p)},D=(m,h,p)=>{const c=new window.ymaps.Polyline([h,p],{hintContent:"Route"},{strokeColor:"#0000FF",strokeWidth:4,strokeOpacity:.7});m.geoObjects.add(c),o.current.push(c)};return e.createElement(e.Fragment,null,e.createElement("div",{ref:d,style:{width:"100%",height:"400px"}}),e.createElement(oe,{validator:g,onTimeDataUpdate:y}))}function re(t){const[a,y]=E.useState(t);return E.useEffect(()=>{if(y(t),!t||t==="00:00:00")return;const r=setInterval(()=>{y(N=>{const[g,v,d]=N.split(":").map(Number);let s=d+1,o=v,f=g;return s>=60&&(s=0,o+=1),o>=60&&(o=0,f+=1),f>=24&&(f=0),`${String(f).padStart(2,"0")}:${String(o).padStart(2,"0")}:${String(s).padStart(2,"0")}`})},1e3);return()=>clearInterval(r)},[t]),a}const Q=[{code:"AUD",name:"Australian Dollar"},{code:"BGN",name:"Bulgarian Lev"},{code:"BRL",name:"Brazilian Real"},{code:"CAD",name:"Canadian Dollar"},{code:"CHF",name:"Swiss Franc"},{code:"CNY",name:"Chinese Yuan"},{code:"CZK",name:"Czech Koruna"},{code:"DKK",name:"Danish Krone"},{code:"EUR",name:"Euro"},{code:"GBP",name:"British Pound Sterling"},{code:"HKD",name:"Hong Kong Dollar"},{code:"HUF",name:"Hungarian Forint"},{code:"IDR",name:"Indonesian Rupiah"},{code:"ILS",name:"Israeli New Shekel"},{code:"INR",name:"Indian Rupee"},{code:"ISK",name:"Icelandic Krona"},{code:"JPY",name:"Japanese Yen"},{code:"KRW",name:"South Korean Won"},{code:"MXN",name:"Mexican Peso"},{code:"MYR",name:"Malaysian Ringgit"},{code:"NOK",name:"Norwegian Krone"},{code:"NZD",name:"New Zealand Dollar"},{code:"PHP",name:"Philippine Peso"},{code:"PLN",name:"Polish Zloty"},{code:"RON",name:"Romanian Leu"},{code:"SEK",name:"Swedish Krona"},{code:"SGD",name:"Singapore Dollar"},{code:"THB",name:"Thai Baht"},{code:"TRY",name:"Turkish Lira"},{code:"USD",name:"United States Dollar"},{code:"ZAR",name:"South African Rand"}];function ce({totalScore:t}){const[a,y]=E.useState(!1),[r,N]=E.useState("USD"),[g,v]=E.useState(t),d=async s=>{const o=s.target.value;if(o!==r){y(!0);try{if(o==="USD")v(t);else{const w=(await(await fetch(`https://api.frankfurter.dev/v1/latest?base=USD&symbols=${o}`)).json()).rates[o];v((parseFloat(t)*w).toFixed(2))}N(o)}catch(f){console.error("Conversion error:",f)}finally{y(!1)}}};return E.useEffect(()=>{r==="USD"?v(t):fetch(`https://api.frankfurter.dev/v1/latest?base=USD&symbols=${r}`).then(s=>s.json()).then(s=>{const o=s.rates[r];v((parseFloat(t)*o).toFixed(2))}).catch(console.error)},[t]),e.createElement("div",{className:"summ-price"},e.createElement("div",null,e.createElement("span",{className:"label"},"üíµ –ü–æ–ª–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:"),e.createElement("p2",{id:"rater"},r),e.createElement("span",{id:"summary",className:"value"},a?"Converting...":g)),e.createElement("select",{id:"selector",className:"select-container",onChange:d,value:r,disabled:a},Q.map(s=>e.createElement("option",{key:s.code,value:s.code},s.name))))}function se({location:t,i:a,timeData:y,data:r,onPointUpdate:N,prevTypic:g,initialPointsCount:v}){var i,u,C,A,R,I,O,U,$,T,F,M,j,K,B,L,z,H,Y,G,q,Z,J;const d=y.find(S=>S.id===a)||{},s=re(d.time),[o,f]=E.useState(a>=v),[n,w]=E.useState({loc:t==="!"?null:t,typic:((i=r.typic)==null?void 0:i[a])==="!"?null:((u=r.typic)==null?void 0:u[a])||"poliline",date_to:((C=r.date_to)==null?void 0:C[a])==="!"?null:((A=r.date_to)==null?void 0:A[a])||"",date_out:((R=r.date_out)==null?void 0:R[a])==="!"?null:((I=r.date_out)==null?void 0:I[a])||"",air:((O=r.air)==null?void 0:O[a])==="!"?null:((U=r.air)==null?void 0:U[a])||"",air2:(($=r.air2)==null?void 0:$[a])==="!"?null:((T=r.air2)==null?void 0:T[a])||"",icao:((F=r.icao)==null?void 0:F[a])==="!"?null:((M=r.icao)==null?void 0:M[a])||"",icao2:((j=r.icao2)==null?void 0:j[a])==="!"?null:((K=r.icao2)==null?void 0:K[a])||"",gost:((B=r.gost)==null?void 0:B[a])==="!"?null:((L=r.gost)==null?void 0:L[a])||"",cost:((z=r.cost)==null?void 0:z[a])==="!"?null:(H=r.cost)!=null&&H[a]?r.cost[a].split("-")[0]:"",rec:((Y=r.rec)==null?void 0:Y[a])==="!"?null:((G=r.rec)==null?void 0:G[a])||"",currency:((q=r.cost)==null?void 0:q[a])==="!"?null:(Z=r.cost)!=null&&Z[a]&&r.cost[a].split("-")[1]||"USD"}),b=n.air&&n.air!=="!"&&n.air!==void 0,_=n.air2&&n.air2!=="!"&&n.air2!==void 0,D=n.icao&&n.icao!=="!"&&n.icao!==void 0,m=n.icao2&&n.icao2!=="!"&&n.icao2!==void 0,h=n.date_to&&n.date_to!=="!"&&n.date_to!==void 0,p=S=>{const{name:P,value:k}=S.target;w(V=>({...V,[P]:k}))},c=()=>{f(!1);const S={loc:n.loc,typic:n.typic,date_to:n.date_to,date_out:n.date_out,air:g==="poliline"?n.air:null,air2:n.typic==="poliline"?n.air2:null,icao:g==="poliline"?n.icao:null,icao2:n.typic==="poliline"?n.icao2:null,gost:n.gost,cost:`${n.cost}-${n.currency}`,rec:n.rec};N(a,S)},l=(S,P)=>{if(!S||!P)return null;const k=new Date(S),X=new Date(P)-k,W=Math.ceil(X/(1e3*60*60*24));return W>0?W:null};return o?e.createElement("div",{className:"route-point",key:`point-${a}`},e.createElement("div",{className:"point-header"},e.createElement("h3",null,"üìç ",t||"–ù–µ —É–∫–∞–∑–∞–Ω–æ",e.createElement("p",{className:`rater-${a} time-displayer`,style:{color:d.error?"red":"inherit"}},"‚è∞ ",d.error?"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏":s))),e.createElement("div",null,e.createElement("span",{className:"label"},"–°–ø–æ—Å–æ–± –ø–µ—Ä–µ–¥–≤–∏–∂–µ–Ω–∏—è:"),e.createElement("select",{name:"typic",value:n.typic,onChange:p},e.createElement("option",{value:"poliline",selected:!0},"poliline"),e.createElement("option",{value:"car"},"car"))),e.createElement("div",{className:"point-dates"},e.createElement("div",null,e.createElement("span",{className:"label"},"–ü—Ä–∏–±—ã—Ç–∏–µ:"),e.createElement("input",{type:"date",name:"date_to",value:n.date_to,onChange:p,required:!0})),e.createElement("div",null,e.createElement("span",{className:"label"},"–û—Ç–±—ã—Ç–∏–µ:"),e.createElement("input",{type:"date",name:"date_out",value:n.date_out,onChange:p,required:!0}))),g==="poliline"&&e.createElement(e.Fragment,null,e.createElement("div",null,e.createElement("span",{className:"label"},"–ê—ç—Ä–æ–ø–æ—Ä—Ç –ø—Ä–∏–ª–µ—Ç–∞:"),e.createElement("input",{type:"text",name:"air",value:n.air,onChange:p})),e.createElement("div",null,e.createElement("span",{className:"label"},"ICAO –∫–æ–¥ –ø—Ä–∏–ª–µ—Ç–∞:"),e.createElement("input",{type:"text",name:"icao",value:n.icao,onChange:p}))),n.typic==="poliline"&&e.createElement(e.Fragment,null,e.createElement("div",null,e.createElement("span",{className:"label"},"–ê—ç—Ä–æ–ø–æ—Ä—Ç –≤—ã–ª–µ—Ç–∞:"),e.createElement("input",{type:"text",name:"air2",value:n.air2,onChange:p})),e.createElement("div",null,e.createElement("span",{className:"label"},"ICAO –∫–æ–¥ –≤—ã–ª–µ—Ç–∞:"),e.createElement("input",{type:"text",name:"icao2",value:n.icao2,onChange:p}))),e.createElement("div",{className:"hotel-label"},e.createElement("span",{className:"label"},"–ì–æ—Å—Ç–∏–Ω–∏—Ü–∞:"),e.createElement("input",{type:"text",name:"gost",value:n.gost,onChange:p})),e.createElement("div",{className:"point-price"},e.createElement("span",{className:"label"},"–°—Ç–æ–∏–º–æ—Å—Ç—å:"),e.createElement("input",{type:"text",name:"cost",value:n.cost,onChange:p}),e.createElement("select",{name:"currency",value:n.currency,onChange:p},Q.map(S=>e.createElement("option",{key:S.code,value:S.code},S.code)))),e.createElement("button",{onClick:c,disabled:!n.date_to||!n.date_out,className:"save-btn"},"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å")):e.createElement("div",{className:"route-point",key:`point-${a}`},e.createElement("div",{className:"point-header"},e.createElement("h3",null,"üìç ",t||"–ù–µ —É–∫–∞–∑–∞–Ω–æ",e.createElement("p",{className:`rater-${a} time-displayer`,style:{color:d.error?"red":"inherit"}},"‚è∞ ",d.error?"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏":s)),h&&e.createElement("span",{className:"badge"},"–†–∞—Å—á—ë—Ç –¥–Ω–µ–π: ",l(n.date_to,n.date_out)||"N/A")),e.createElement("div",null,"–°–ø–æ—Å–æ–± –ø–µ—Ä–µ–¥–≤–∏–∂–µ–Ω–∏—è - ",n.typic||"–ù–µ —É–∫–∞–∑–∞–Ω–æ"),e.createElement("div",{className:"point-dates"},h&&e.createElement("div",null,e.createElement("span",{className:"label"},"–ü—Ä–∏–±—ã—Ç–∏–µ:"),e.createElement("span",{className:"value"},n.date_to)),e.createElement("div",null,e.createElement("span",{className:"label"},"–û—Ç–±—ã—Ç–∏–µ:"),e.createElement("span",{className:"value"},n.date_out||"–ù–µ —É–∫–∞–∑–∞–Ω–æ"))),g==="poliline"&&b&&e.createElement("div",null,e.createElement("span",{className:"label"},"–ê—ç—Ä–æ–ø–æ—Ä—Ç –ø—Ä–∏–ª–µ—Ç–∞:"),e.createElement("span",{className:"value"},n.air)),g==="poliline"&&D&&e.createElement("div",null,e.createElement("span",{className:"label"},"ICAO –∫–æ–¥ –ø—Ä–∏–ª–µ—Ç–∞:"),e.createElement("span",{className:"value"},n.icao)),_&&n.typic==="poliline"&&e.createElement("div",null,e.createElement("span",{className:"label"},"–ê—ç—Ä–æ–ø–æ—Ä—Ç –≤—ã–ª–µ—Ç–∞:"),e.createElement("span",{className:"value"},n.air2)),m&&n.typic==="poliline"&&e.createElement("div",null,e.createElement("span",{className:"label"},"ICAO –∫–æ–¥ –≤—ã–ª–µ—Ç–∞:"),e.createElement("span",{className:"value"},n.icao2)),e.createElement("div",{className:"hotel-label"},e.createElement("span",{className:"label"},"–ì–æ—Å—Ç–∏–Ω–∏—Ü–∞:"),e.createElement("span",{className:"value"},n.gost||"–ù–µ —É–∫–∞–∑–∞–Ω–æ")),e.createElement("div",{className:"point-price"},e.createElement("span",{className:"label"},"–°—Ç–æ–∏–º–æ—Å—Ç—å:"),e.createElement("span",{className:"value"},n.cost&&n.currency?`${n.cost}-${n.currency}`:"0-USD")),((J=r.rec)==null?void 0:J[a])&&e.createElement("a",{href:r.rec[a],className:"booking-btn"},"–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –≥–æ—Å—Ç–∏–Ω–∏—Ü—É ‚Üí"))}function le({data:t,timeData:a=[],onPointUpdate:y,initialPointsCount:r}){return e.createElement("div",{className:"sidebar"},t.loc.map((N,g)=>{var v;return e.createElement(se,{key:`point-${g}`,location:N,i:g,timeData:a,data:t,onPointUpdate:y,prevTypic:g>0?(v=t.typic)==null?void 0:v[g-1]:null,initialPointsCount:r})}))}function ie({onSave:t}){return e.createElement("button",{className:"fixed-button",onClick:t},"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ")}function ue({data:t}){const[a,y]=E.useState([]),[r,N]=E.useState(!1),[g,v]=E.useState(Array.isArray(t.loc)?t.loc.length:0),s=(c=>{const l={};return["loc","date_to","date_out","gost","wait","cost","rec","air","air2","icao","icao2","typic","price"].forEach(u=>{c[u]==="!"?l[u]=null:Array.isArray(c[u])?l[u]=c[u].map(C=>C==="!"?null:C):l[u]=c[u]}),l})({...t,cost:t.cost||t.price||[],gost:t.gost||t.hotel||[]}),[o,f]=E.useState(s),[n,w]=E.useState(0);E.useEffect(()=>{const c=parseFloat(t.total_score)||0;w(c),_(s).then(l=>{w(i=>Math.max(i,l))})},[]);const b={loc:t.loc||[],date_to:t.date_to||[],date_out:t.date_out||[],gost:t.gost||[],wait:t.wait||[],cost:t.cost||[],rec:t.rec||[],air:t.air||[],air2:t.air2||[],icao:t.icao||[],icao2:t.icao2||[],typic:t.typic||[],total_score:n.toString()},_=async c=>{let l=0;if(c.cost){for(let i=0;i<c.cost.length;i++)if(c.cost[i]){const[u,C]=c.cost[i].split("-"),A=parseFloat(u)||0;if(C.toUpperCase()==="USD")l+=A;else{const R=await m(C.toUpperCase(),"USD",A);l+=parseFloat(R)||0}}}return l},D=async(c,l)=>{const i={...o,loc:[...o.loc],typic:[...o.typic],date_to:[...o.date_to],date_out:[...o.date_out],air:[...o.air],air2:[...o.air2],icao:[...o.icao],icao2:[...o.icao2],gost:[...o.gost],cost:[...o.cost]};i.loc[c]=l.loc,i.typic[c]=l.typic,i.date_to[c]=l.date_to,i.date_out[c]=l.date_out,i.air[c]=l.air,i.air2[c]=l.air2,i.icao[c]=l.icao,i.icao2[c]=l.icao2,i.gost[c]=l.gost,i.cost[c]=l.cost,console.log("–ó–ê–õ–ò–õ–ò COST: ",l.cost);const u=await _(i);w(u),f(i)};if(!t||!Array.isArray(b.loc))return e.createElement("div",{className:"error-message"},"–î–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–ª–∏ –∏–º–µ—é—Ç –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç");async function m(c,l,i){try{const C=await(await fetch(`https://api.frankfurter.dev/v1/latest?base=${c}&symbols=${l}`)).json();return(i*C.rates[l]).toFixed(2)}catch(u){return console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏:",u),null}}const h=async()=>{try{const c=o.loc.map((i,u)=>({place:o.loc[u]||null,to:o.date_to[u]||null,out:o.date_out[u]||null,airto:o.air[u]||null,airout:o.air2[u]||null,icao:o.icao[u]||null,icao1:o.icao2[u]||null,hotel:o.gost[u]||null,price:o.cost[u]||"0-USD",type:o.typic[u]||"poliline"}));(await fetch("http://127.0.0.1:8000/api/v1/app/send/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)})).ok?window.location.href="/api/v1/":console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏")}catch(c){console.error("–û—à–∏–±–∫–∞:",c)}},p=!t.price||Array.isArray(t.price)&&t.price.length===0;return e.createElement("div",{className:"map-page"},e.createElement(ae,{locations:o.loc,connectionTypes:o.typic,onTimeDataUpdate:y,creatingNewPoint:r,setCreatingNewPoint:N}),e.createElement("div",{className:"sidebar-grid"},e.createElement(ce,{totalScore:b.total_score}),e.createElement("div",{className:"overlay-container"},e.createElement(le,{data:o,timeData:a,onPointUpdate:D,initialPointsCount:g}),p&&e.createElement("button",{className:"booking-btn",onClick:()=>N(!0),disabled:r,style:{cursor:r?"not-allowed":"pointer"}},"–î–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫—É ‚Üí"))),p&&e.createElement(ie,{onSave:h}))}const me=window.__MAP_DATA__||{loc:[],date_to:[],date_out:[],gost:[],wait:[],cost:[],rec:[],total_score:"0"},pe=x.createRoot(document.getElementById("map-root"));pe.render(e.createElement(ue,{data:me}));
