import{r as d,R as e,a as x}from"./assets/client-DlR8uHNE.js";const ee=n=>new Promise(r=>setTimeout(r,n)),te=n=>(n==null?void 0:n.split(" ")[1])||"",ne=()=>({getDataByRegion:async(r,h)=>{try{const a=await fetch("/api/v1/app/location/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({latitude:r,longitude:h})});if(!a.ok)throw new Error(`API request failed with status ${a.status}`);return await a.json()}catch(a){return console.error("Error during data retrieval:",a),{error:a.message}}},spliter:te}),oe=({validator:n,onTimeDataUpdate:r})=>{const{getDataByRegion:h,spliter:a}=ne();return d.useEffect(()=>{if(!n||n.length===0){console.warn("Validator is empty"),r([]);return}(async()=>{const E=[];for(let l=0;l<n.length;l++)try{if(n[l]===0){E.push({id:l,time:"00:00:00",error:"Geocoding failed"});continue}l>0&&await ee(2e3);const i=await h(n[l][0],n[l][1]);let m="00:00:00",t=null;i!=null&&i.formatted?m=a(i.formatted):i!=null&&i.time?m=i.time:t=(i==null?void 0:i.error)||"Invalid response structure",E.push({id:l,time:m,error:t})}catch(i){console.error(`Error processing point ${l}:`,i),E.push({id:l,time:"00:00:00",error:"API request failed"})}r(E)})()},[n]),null};function ae({locations:n=[],connectionTypes:r=[],onTimeDataUpdate:h,creatingNewPoint:a,setCreatingNewPoint:y}){const[E,g]=d.useState([]),l=d.useRef(null),i=d.useRef(null),m=d.useRef([]),[t,S]=d.useState(null);d.useEffect(()=>{if(!(!window.ymaps||i.current))return window.ymaps.ready(()=>{try{const p=new window.ymaps.Map(l.current,{center:[55.76,37.64],zoom:3,controls:["zoomControl","searchControl"]});i.current=p,m.current=[],N(p)}catch(p){console.error("Error initializing map:",p)}}),()=>{i.current&&(m.current.forEach(p=>{i.current.geoObjects.remove(p)}),i.current.destroy(),i.current=null,m.current=[])}},[]),d.useEffect(()=>{if(!i.current)return;const p=o=>{a&&(S(o.get("coords")),y(!1))};return i.current.events.add("click",p),()=>{i.current.events.remove("click",p)}},[a]),d.useEffect(()=>{if(!t)return;(async()=>{try{console.log("Clicked on map:",t);const c=(await ymaps.geocode(t)).geoObjects.get(0).getAddressLine();n.push(c),console.log("Deleting old bullshit..."),m.current.forEach(s=>{i.current.geoObjects.remove(s)}),m.current=[],console.log("goint to start process locations"),N(i.current),console.log("ENDED ADDING POINT")}catch(o){console.error("Error processing click:",o)}finally{S(null)}})()},[t]),d.useEffect(()=>{i.current&&(m.current.forEach(p=>{i.current.geoObjects.remove(p)}),m.current=[],N(i.current))},[n,r]);const N=async p=>{if(!n.length)return;console.log("Processing locations: ",n);const o=[],u=[];for(let c=0;c<n.length;c++)try{const s=await b(n[c]);u.push(s),o.push(s);const f=new window.ymaps.Placemark(s,{balloonContent:n[c]});p.geoObjects.add(f),m.current.push(f)}catch(s){console.error(`Error geocoding location ${n[c]}:`,s),o.push(0)}if(u.length>1){console.log(r);for(let c=0;c<u.length-1;c++){const s=u[c],f=u[c+1],w=r[c]||"poliline";s&&f&&_(p,s,f,w)}}g(o)},b=p=>new Promise((o,u)=>{window.ymaps.geocode(p,{results:1}).then(c=>{const s=c.geoObjects.get(0);s?o(s.geometry.getCoordinates()):u(`No results for address: ${p}`)},c=>{u(`Geocoding error for address: ${p}, ${c}`)})}),_=(p,o,u,c)=>{if(c==="car"){const s=new window.ymaps.multiRouter.MultiRoute({referencePoints:[o,u],params:{routingMode:"auto"}},{boundsAutoApply:!0});p.geoObjects.add(s),m.current.push(s),s.model.events.add("requestsuccess",function(){try{const w=s.getActiveRoute().properties.get("distance").value;console.log(`Route distance: ${w} meters`)}catch{console.warn("Failed to get route info, drawing polyline instead"),C(p,o,u)}})}else C(p,o,u)},C=(p,o,u)=>{const c=new window.ymaps.Polyline([o,u],{hintContent:"Route"},{strokeColor:"#0000FF",strokeWidth:4,strokeOpacity:.7});p.geoObjects.add(c),m.current.push(c)};return e.createElement(e.Fragment,null,e.createElement("div",{ref:l,style:{width:"100%",height:"400px"}}),e.createElement(oe,{validator:E,onTimeDataUpdate:h}))}function re(n){const[r,h]=d.useState(n);return d.useEffect(()=>{if(h(n),!n||n==="00:00:00")return;const a=setInterval(()=>{h(y=>{const[E,g,l]=y.split(":").map(Number);let i=l+1,m=g,t=E;return i>=60&&(i=0,m+=1),m>=60&&(m=0,t+=1),t>=24&&(t=0),`${String(t).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(i).padStart(2,"0")}`})},1e3);return()=>clearInterval(a)},[n]),r}const Q=[{code:"AUD",name:"Australian Dollar"},{code:"BGN",name:"Bulgarian Lev"},{code:"BRL",name:"Brazilian Real"},{code:"CAD",name:"Canadian Dollar"},{code:"CHF",name:"Swiss Franc"},{code:"CNY",name:"Chinese Yuan"},{code:"CZK",name:"Czech Koruna"},{code:"DKK",name:"Danish Krone"},{code:"EUR",name:"Euro"},{code:"GBP",name:"British Pound Sterling"},{code:"HKD",name:"Hong Kong Dollar"},{code:"HUF",name:"Hungarian Forint"},{code:"IDR",name:"Indonesian Rupiah"},{code:"ILS",name:"Israeli New Shekel"},{code:"INR",name:"Indian Rupee"},{code:"ISK",name:"Icelandic Krona"},{code:"JPY",name:"Japanese Yen"},{code:"KRW",name:"South Korean Won"},{code:"MXN",name:"Mexican Peso"},{code:"MYR",name:"Malaysian Ringgit"},{code:"NOK",name:"Norwegian Krone"},{code:"NZD",name:"New Zealand Dollar"},{code:"PHP",name:"Philippine Peso"},{code:"PLN",name:"Polish Zloty"},{code:"RON",name:"Romanian Leu"},{code:"SEK",name:"Swedish Krona"},{code:"SGD",name:"Singapore Dollar"},{code:"THB",name:"Thai Baht"},{code:"TRY",name:"Turkish Lira"},{code:"USD",name:"United States Dollar"},{code:"ZAR",name:"South African Rand"}];function ce({totalScore:n}){const[r,h]=d.useState(!1),[a,y]=d.useState("USD"),[E,g]=d.useState(n),l=async i=>{const m=i.target.value;if(m!==a){h(!0);try{if(m==="USD")g(n);else{const N=(await(await fetch(`https://api.frankfurter.dev/v1/latest?base=USD&symbols=${m}`)).json()).rates[m];g((parseFloat(n)*N).toFixed(2))}y(m)}catch(t){console.error("Conversion error:",t)}finally{h(!1)}}};return d.useEffect(()=>{a==="USD"?g(n):fetch(`https://api.frankfurter.dev/v1/latest?base=USD&symbols=${a}`).then(i=>i.json()).then(i=>{const m=i.rates[a];g((parseFloat(n)*m).toFixed(2))}).catch(console.error)},[n]),e.createElement("div",{className:"summ-price"},e.createElement("div",null,e.createElement("span",{className:"label"},"üíµ –ü–æ–ª–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:"),e.createElement("p2",{id:"rater"},a),e.createElement("span",{id:"summary",className:"value"},r?"Converting...":E)),e.createElement("select",{id:"selector",className:"select-container",onChange:l,value:a,disabled:r},Q.map(i=>e.createElement("option",{key:i.code,value:i.code},i.name))))}function se({location:n,i:r,timeData:h,data:a,onPointUpdate:y,prevTypic:E}){var s,f,w,D,P,k,I,O,U,$,T,F,M,j,K,B,L,z,H,Y,G,q,Z,J;const g=h.find(v=>v.id===r)||{},l=re(g.time),[i,m]=d.useState(!((s=a.date_out)!=null&&s[r])),[t,S]=d.useState({loc:n==="!"?null:n,typic:((f=a.typic)==null?void 0:f[r])==="!"?null:((w=a.typic)==null?void 0:w[r])||"poliline",date_to:((D=a.date_to)==null?void 0:D[r])==="!"?null:((P=a.date_to)==null?void 0:P[r])||"",date_out:((k=a.date_out)==null?void 0:k[r])==="!"?null:((I=a.date_out)==null?void 0:I[r])||"",air:((O=a.air)==null?void 0:O[r])==="!"?null:((U=a.air)==null?void 0:U[r])||"",air2:(($=a.air2)==null?void 0:$[r])==="!"?null:((T=a.air2)==null?void 0:T[r])||"",icao:((F=a.icao)==null?void 0:F[r])==="!"?null:((M=a.icao)==null?void 0:M[r])||"",icao2:((j=a.icao2)==null?void 0:j[r])==="!"?null:((K=a.icao2)==null?void 0:K[r])||"",gost:((B=a.gost)==null?void 0:B[r])==="!"?null:((L=a.gost)==null?void 0:L[r])||"",cost:((z=a.cost)==null?void 0:z[r])==="!"?null:(H=a.cost)!=null&&H[r]?a.cost[r].split("-")[0]:"",rec:((Y=a.rec)==null?void 0:Y[r])==="!"?null:((G=a.rec)==null?void 0:G[r])||"",currency:((q=a.cost)==null?void 0:q[r])==="!"?null:(Z=a.cost)!=null&&Z[r]&&a.cost[r].split("-")[1]||"USD"}),N=t.air&&t.air!=="!"&&t.air!==void 0,b=t.air2&&t.air2!=="!"&&t.air2!==void 0,_=t.icao&&t.icao!=="!"&&t.icao!==void 0,C=t.icao2&&t.icao2!=="!"&&t.icao2!==void 0,p=t.date_to&&t.date_to!=="!"&&t.date_to!==void 0,o=v=>{const{name:A,value:R}=v.target;S(V=>({...V,[A]:R}))},u=()=>{m(!1);const v={loc:t.loc,typic:t.typic,date_to:t.date_to,date_out:t.date_out,air:E==="poliline"?t.air:null,air2:t.typic==="poliline"?t.air2:null,icao:E==="poliline"?t.icao:null,icao2:t.typic==="poliline"?t.icao2:null,gost:t.gost,cost:`${t.cost}-${t.currency}`,rec:t.rec};y(r,v)},c=(v,A)=>{if(!v||!A)return null;const R=new Date(v),X=new Date(A)-R,W=Math.ceil(X/(1e3*60*60*24));return W>0?W:null};return i?e.createElement("div",{className:"route-point",key:`point-${r}`},e.createElement("div",{className:"point-header"},e.createElement("h3",null,"üìç ",n||"–ù–µ —É–∫–∞–∑–∞–Ω–æ",e.createElement("p",{className:`rater-${r} time-displayer`,style:{color:g.error?"red":"inherit"}},"‚è∞ ",g.error?"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏":l))),e.createElement("div",null,e.createElement("span",{className:"label"},"–°–ø–æ—Å–æ–± –ø–µ—Ä–µ–¥–≤–∏–∂–µ–Ω–∏—è:"),e.createElement("select",{name:"typic",value:t.typic,onChange:o},e.createElement("option",{value:"poliline",selected:!0},"poliline"),e.createElement("option",{value:"car"},"car"))),e.createElement("div",{className:"point-dates"},e.createElement("div",null,e.createElement("span",{className:"label"},"–ü—Ä–∏–±—ã—Ç–∏–µ:"),e.createElement("input",{type:"date",name:"date_to",value:t.date_to,onChange:o,required:!0})),e.createElement("div",null,e.createElement("span",{className:"label"},"–û—Ç–±—ã—Ç–∏–µ:"),e.createElement("input",{type:"date",name:"date_out",value:t.date_out,onChange:o,required:!0}))),E==="poliline"&&e.createElement(e.Fragment,null,e.createElement("div",null,e.createElement("span",{className:"label"},"–ê—ç—Ä–æ–ø–æ—Ä—Ç –ø—Ä–∏–ª–µ—Ç–∞:"),e.createElement("input",{type:"text",name:"air",value:t.air,onChange:o})),e.createElement("div",null,e.createElement("span",{className:"label"},"ICAO –∫–æ–¥ –ø—Ä–∏–ª–µ—Ç–∞:"),e.createElement("input",{type:"text",name:"icao",value:t.icao,onChange:o}))),t.typic==="poliline"&&e.createElement(e.Fragment,null,e.createElement("div",null,e.createElement("span",{className:"label"},"–ê—ç—Ä–æ–ø–æ—Ä—Ç –≤—ã–ª–µ—Ç–∞:"),e.createElement("input",{type:"text",name:"air2",value:t.air2,onChange:o})),e.createElement("div",null,e.createElement("span",{className:"label"},"ICAO –∫–æ–¥ –≤—ã–ª–µ—Ç–∞:"),e.createElement("input",{type:"text",name:"icao2",value:t.icao2,onChange:o}))),e.createElement("div",{className:"hotel-label"},e.createElement("span",{className:"label"},"–ì–æ—Å—Ç–∏–Ω–∏—Ü–∞:"),e.createElement("input",{type:"text",name:"gost",value:t.gost,onChange:o})),e.createElement("div",{className:"point-price"},e.createElement("span",{className:"label"},"–°—Ç–æ–∏–º–æ—Å—Ç—å:"),e.createElement("input",{type:"text",name:"cost",value:t.cost,onChange:o}),e.createElement("select",{name:"currency",value:t.currency,onChange:o},Q.map(v=>e.createElement("option",{key:v.code,value:v.code},v.code)))),e.createElement("button",{onClick:u,disabled:!t.date_to||!t.date_out,className:"save-btn"},"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å")):e.createElement("div",{className:"route-point",key:`point-${r}`},e.createElement("div",{className:"point-header"},e.createElement("h3",null,"üìç ",n||"–ù–µ —É–∫–∞–∑–∞–Ω–æ",e.createElement("p",{className:`rater-${r} time-displayer`,style:{color:g.error?"red":"inherit"}},"‚è∞ ",g.error?"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏":l)),p&&e.createElement("span",{className:"badge"},"–†–∞—Å—á—ë—Ç –¥–Ω–µ–π: ",c(t.date_to,t.date_out)||"N/A")),e.createElement("div",null,"–°–ø–æ—Å–æ–± –ø–µ—Ä–µ–¥–≤–∏–∂–µ–Ω–∏—è - ",t.typic||"–ù–µ —É–∫–∞–∑–∞–Ω–æ"),e.createElement("div",{className:"point-dates"},p&&e.createElement("div",null,e.createElement("span",{className:"label"},"–ü—Ä–∏–±—ã—Ç–∏–µ:"),e.createElement("span",{className:"value"},t.date_to)),e.createElement("div",null,e.createElement("span",{className:"label"},"–û—Ç–±—ã—Ç–∏–µ:"),e.createElement("span",{className:"value"},t.date_out||"–ù–µ —É–∫–∞–∑–∞–Ω–æ"))),E==="poliline"&&N&&e.createElement("div",null,e.createElement("span",{className:"label"},"–ê—ç—Ä–æ–ø–æ—Ä—Ç –ø—Ä–∏–ª–µ—Ç–∞:"),e.createElement("span",{className:"value"},t.air)),E==="poliline"&&_&&e.createElement("div",null,e.createElement("span",{className:"label"},"ICAO –∫–æ–¥ –ø—Ä–∏–ª–µ—Ç–∞:"),e.createElement("span",{className:"value"},t.icao)),b&&t.typic==="poliline"&&e.createElement("div",null,e.createElement("span",{className:"label"},"–ê—ç—Ä–æ–ø–æ—Ä—Ç –≤—ã–ª–µ—Ç–∞:"),e.createElement("span",{className:"value"},t.air2)),C&&t.typic==="poliline"&&e.createElement("div",null,e.createElement("span",{className:"label"},"ICAO –∫–æ–¥ –≤—ã–ª–µ—Ç–∞:"),e.createElement("span",{className:"value"},t.icao2)),e.createElement("div",{className:"hotel-label"},e.createElement("span",{className:"label"},"–ì–æ—Å—Ç–∏–Ω–∏—Ü–∞:"),e.createElement("span",{className:"value"},t.gost||"–ù–µ —É–∫–∞–∑–∞–Ω–æ")),e.createElement("div",{className:"point-price"},e.createElement("span",{className:"label"},"–°—Ç–æ–∏–º–æ—Å—Ç—å:"),e.createElement("span",{className:"value"},t.cost&&t.currency?`${t.cost}-${t.currency}`:"0-USD")),((J=a.rec)==null?void 0:J[r])&&e.createElement("a",{href:a.rec[r],className:"booking-btn"},"–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –≥–æ—Å—Ç–∏–Ω–∏—Ü—É ‚Üí"))}function le({data:n,timeData:r=[],onPointUpdate:h}){return e.createElement("div",{className:"sidebar"},n.loc.map((a,y)=>{var E;return e.createElement(se,{key:`point-${y}`,location:a,i:y,timeData:r,data:n,onPointUpdate:h,prevTypic:y>0?(E=n.typic)==null?void 0:E[y-1]:null})}))}function ie({onSave:n}){return e.createElement("button",{className:"fixed-button",onClick:n},"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ")}function ue({data:n}){const[r,h]=d.useState([]),[a,y]=d.useState(!1),g=(o=>{const u={};return["loc","date_to","date_out","gost","wait","cost","rec","air","air2","icao","icao2","typic","price"].forEach(s=>{o[s]==="!"?u[s]=null:Array.isArray(o[s])?u[s]=o[s].map(f=>f==="!"?null:f):u[s]=o[s]}),u})({...n,cost:n.cost||n.price||[]}),[l,i]=d.useState(g),[m,t]=d.useState(0);d.useEffect(()=>{const o=parseFloat(n.total_score)||0;t(o),N(g).then(u=>{t(c=>Math.max(c,u))})},[]);const S={loc:n.loc||[],date_to:n.date_to||[],date_out:n.date_out||[],gost:n.gost||[],wait:n.wait||[],cost:n.cost||[],rec:n.rec||[],air:n.air||[],air2:n.air2||[],icao:n.icao||[],icao2:n.icao2||[],typic:n.typic||[],total_score:m.toString()},N=async o=>{let u=0;if(o.cost){for(let c=0;c<o.cost.length;c++)if(o.cost[c]){const[s,f]=o.cost[c].split("-"),w=parseFloat(s)||0;if(f.toUpperCase()==="USD")u+=w;else{const D=await _(f.toUpperCase(),"USD",w);u+=parseFloat(D)||0}}}return u},b=async(o,u)=>{const c={...l,loc:[...l.loc],typic:[...l.typic],date_to:[...l.date_to],date_out:[...l.date_out],air:[...l.air],air2:[...l.air2],icao:[...l.icao],icao2:[...l.icao2],gost:[...l.gost],cost:[...l.cost]};c.loc[o]=u.loc,c.typic[o]=u.typic,c.date_to[o]=u.date_to,c.date_out[o]=u.date_out,c.air[o]=u.air,c.air2[o]=u.air2,c.icao[o]=u.icao,c.icao2[o]=u.icao2,c.gost[o]=u.gost,c.cost[o]=u.cost,console.log("–ó–ê–õ–ò–õ–ò COST: ",u.cost);const s=await N(c);t(s),i(c)};if(!n||!Array.isArray(S.loc))return e.createElement("div",{className:"error-message"},"–î–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–ª–∏ –∏–º–µ—é—Ç –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç");async function _(o,u,c){try{const f=await(await fetch(`https://api.frankfurter.dev/v1/latest?base=${o}&symbols=${u}`)).json();return(c*f.rates[u]).toFixed(2)}catch(s){return console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏:",s),null}}const C=async()=>{try{const o=l.loc.map((c,s)=>({place:l.loc[s]||null,to:l.date_to[s]||null,out:l.date_out[s]||null,airto:l.air[s]||null,airout:l.air2[s]||null,icao:l.icao[s]||null,icao1:l.icao2[s]||null,hotel:l.gost[s]||null,price:l.cost[s]||"0-USD",type:l.typic[s]||"poliline"}));(await fetch("http://127.0.0.1:8000/api/v1/app/send/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).ok?window.location.href="/api/v1/":console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏")}catch(o){console.error("–û—à–∏–±–∫–∞:",o)}},p=!n.price||Array.isArray(n.price)&&n.price.length===0;return e.createElement("div",{className:"map-page"},e.createElement(ae,{locations:l.loc,connectionTypes:l.typic,onTimeDataUpdate:h,creatingNewPoint:a,setCreatingNewPoint:y}),e.createElement("div",{className:"sidebar-grid"},e.createElement(ce,{totalScore:S.total_score}),e.createElement("div",{className:"overlay-container"},e.createElement(le,{data:l,timeData:r,onPointUpdate:b}),p&&e.createElement("button",{className:"booking-btn",onClick:()=>y(!0),disabled:a,style:{cursor:a?"not-allowed":"pointer"}},"–î–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫—É ‚Üí"))),p&&e.createElement(ie,{onSave:C}))}const me=window.__MAP_DATA__||{loc:[],date_to:[],date_out:[],gost:[],wait:[],cost:[],rec:[],total_score:"0"},pe=x.createRoot(document.getElementById("map-root"));pe.render(e.createElement(ue,{data:me}));
