{% extends 'base.html' %}

{% block content %}

<link rel="stylesheet" href="/src/adapters/entrypoints/static/icao/trips.css">

<div class="form-container-wrapper" id="form-wrapper">
    <div class="plan">Спланировать путешествие
        <div class="intr">Постройте маршрут вашего путешествия. Добавляйте точки для посещения, а также информацию о
            гостиницах, аэропортах, времени прилета и многое другое.
        </div>
    </div>
    <div class="form-container" id="form-container-0">
        <div class="form-item">
            <label for="point-0" class="name"> Начало путешествия :</label>
            <input type="text" id="point-0" name="point-0" class="form">
        </div>
        <div class="form-item">
            <label class="name">Транспорт отправления</label>
            <select id='type_way-0' class="selector">
                <option value="poliline" selected>poliline</option>
                <option value="car">car</option>
            </select>
        </div>

        <div class="form-item">
            <label for="date_out-0" class="name"> Дата отбытия</label>
            <input type="date" id="date_out-0" name="date_out-0" class="form">
        </div>
        <div class="form-item" id = 'hostel-0'>
            <label for="gost-0" class="name"> Гостиница</label>
            <input type="text" id="gost-0" name="gost-0" class="form">
        </div>
        <div class="form-item" id = 'fly1-0'>
            <label for="air2-0" class="name"> Аэропорт вылета</label>
            <input type="text" id="air2-0" name="air-0" class="form">
            <div class="autocomplete-dropdown" id="airport-dropdown-0"></div>
        </div>
        <div class="form-item" id = 'table1-0'>
            <label for="icao2-0" class="name"> ICAO код</label>
            <input type="text" id="icao2-0" name="icao-0" class="form">
            <div class="autocomplete-dropdown" id="icao-dropdown-0"></div>
        </div>
        <div class="form-item">
            <label for="cost-0" class="name"> Планируемый бюджет</label>
            <input type="number" id="cost-0" name="cost-0" class="form">
        </div>
        <div class="form-item">
            <label for="rate-0" class="name"> Расчетная валюта</label>
            <select id="rate-0" name="rate-0" class="selector"></select>
        </div>
        <div></div>
    </div>
    <button class="add-button" type="button" onclick="addForm()">Добавить пункт</button>
    <!--<a href="/map">-->
    <button type="button" class='end' onclick="submitData()"> Завершить</button>

</div>

<script src="/src/adapters/entrypoints/static/icao/test.js"></script>
<script src="/src/adapters/entrypoints/static/icao/autocomplete.js"></script>

<!--<script>-->
<!--    document.addEventListener('DOMContentLoaded', function() {-->
<!--        // Обработчики для первого контейнера-->
<!--        setupAutocomplete(0);-->
<!--    });-->

<!--    document.addEventListener('DOMContentLoaded', function() {-->
<!--        // Обработчики для первого контейнера-->
<!--        setupAutocomplete(1);-->
<!--    });-->

<!--    function setupAutocomplete(index) {-->
<!--        const airportInput = document.getElementById(`air2-${index}`);-->
<!--        const icaoInput = document.getElementById(`icao2-${index}`);-->
<!--        const airportDropdown = document.getElementById(`airport-dropdown-${index}`);-->
<!--        const icaoDropdown = document.getElementById(`icao-dropdown-${index}`);-->

<!--        // Функция для загрузки данных аэропортов-->
<!--        async function fetchAirports(searchTerm) {-->
<!--            try {-->
<!--                const response = await fetch(`/icao/airport?name=${encodeURIComponent(searchTerm)}`);-->
<!--                if (!response.ok) throw new Error('Network response was not ok');-->
<!--                return await response.json();-->
<!--            } catch (error) {-->
<!--                console.error('Error fetching airports:', error);-->
<!--                return [];-->
<!--            }-->
<!--        }-->

<!--        // Обработчик для поля аэропорта-->
<!--        airportInput.addEventListener('input', async function() {-->
<!--            const searchTerm = this.value;-->
<!--            if (searchTerm.length < 2) {-->
<!--                airportDropdown.style.display = 'none';-->
<!--                return;-->
<!--            }-->

<!--            const airports = await fetchAirports(searchTerm);-->
<!--            if (airports.length > 0) {-->
<!--                airportDropdown.innerHTML = airports.map(airport =>-->
<!--                    `<div data-icao="${airport.icao}" data-name="${airport.name}">-->
<!--                        ${airport.name} (${airport.icao})-->
<!--                    </div>`-->
<!--                ).join('');-->
<!--                airportDropdown.style.display = 'block';-->
<!--            } else {-->
<!--                airportDropdown.style.display = 'none';-->
<!--            }-->
<!--        });-->

<!--        // Обработчик для поля ICAO-->
<!--        icaoInput.addEventListener('input', async function() {-->
<!--            const searchTerm = this.value;-->
<!--            if (searchTerm.length < 2) {-->
<!--                icaoDropdown.style.display = 'none';-->
<!--                return;-->
<!--            }-->

<!--            const airports = await fetchAirports(searchTerm);-->
<!--            if (airports.length > 0) {-->
<!--                icaoDropdown.innerHTML = airports.map(airport =>-->
<!--                    `<div data-icao="${airport.icao}" data-name="${airport.name}">-->
<!--                        ${airport.icao} - ${airport.name}-->
<!--                    </div>`-->
<!--                ).join('');-->
<!--                icaoDropdown.style.display = 'block';-->
<!--            } else {-->
<!--                icaoDropdown.style.display = 'none';-->
<!--            }-->
<!--        });-->

<!--        // Обработчик выбора из dropdown-->
<!--        function handleDropdownSelection(dropdown, inputField, otherField, isIcao) {-->
<!--            dropdown.addEventListener('click', function(e) {-->
<!--                if (e.target && e.target.nodeName === 'DIV') {-->
<!--                    const icao = e.target.getAttribute('data-icao');-->
<!--                    const name = e.target.getAttribute('data-name');-->

<!--                    if (isIcao) {-->
<!--                        inputField.value = icao;-->
<!--                        otherField.value = name;-->
<!--                    } else {-->
<!--                        inputField.value = name;-->
<!--                        otherField.value = icao;-->
<!--                    }-->

<!--                    dropdown.style.display = 'none';-->
<!--                }-->
<!--            });-->
<!--        }-->

<!--        handleDropdownSelection(airportDropdown, airportInput, icaoInput, false);-->
<!--        handleDropdownSelection(icaoDropdown, icaoInput, airportInput, true);-->

<!--        // Скрыть dropdown при клике вне его-->
<!--        document.addEventListener('click', function(e) {-->
<!--            if (!airportInput.contains(e.target) && !airportDropdown.contains(e.target)) {-->
<!--                airportDropdown.style.display = 'none';-->
<!--            }-->
<!--            if (!icaoInput.contains(e.target) && !icaoDropdown.contains(e.target)) {-->
<!--                icaoDropdown.style.display = 'none';-->
<!--            }-->
<!--        });-->
<!--    }-->

<!--&lt;!&ndash;    // Модифицируем функцию addForm() для поддержки автодополнения в новых формах&ndash;&gt;-->
<!--&lt;!&ndash;    function addForm() {&ndash;&gt;-->
<!--&lt;!&ndash;        // ... существующий код addForm() ...&ndash;&gt;-->
<!--&lt;!&ndash;        &ndash;&gt;-->
<!--&lt;!&ndash;        // После создания новой формы вызываем setupAutocomplete для нового индекса&ndash;&gt;-->
<!--&lt;!&ndash;        const newIndex = /* определить новый индекс */;&ndash;&gt;-->
<!--&lt;!&ndash;        setupAutocomplete(newIndex);&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->
<!--</script>-->

{% endblock %}
